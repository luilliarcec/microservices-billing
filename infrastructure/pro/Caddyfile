{
    frankenphp {
                   num_threads 4
                   worker {
                              file /app/public/index.php
                              num 4
                          }
               }

    order php_server before file_server
    auto_https off
}

:8080 {
    root * /app/public

    header {
               X-Frame-Options "SAMEORIGIN"
               X-Content-Type-Options "nosniff"
               X-XSS-Protection "1; mode=block"
               -Server
           }

    encode zstd gzip

    @static {
                path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.woff *.woff2 *.ttf *.eot
            }
    handle @static {
                       file_server
                       header Cache-Control "public, max-age=31536000, immutable"
                   }

    @dotfiles {
                  path */.*
                  not path *.well-known*
              }
    respond @dotfiles 403

    php_server {
                   read_timeout 130s
                   resolve_root_symlink
               }

    try_files {path} {path} / /index.php? {query}

    file_server

    log {
            output stdout
            format json
            level ERROR
        }
}
